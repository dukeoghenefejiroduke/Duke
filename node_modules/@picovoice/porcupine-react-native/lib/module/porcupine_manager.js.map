{"version":3,"names":["VoiceProcessor","Porcupine","PorcupineErrors","PorcupineManager","fromBuiltInKeywords","accessKey","keywords","detectionCallback","processErrorCallback","modelPath","device","sensitivities","porcupine","fromKeywordPaths","keywordPaths","constructor","_defineProperty","_porcupine","_voiceProcessor","instance","_frameListener","frame","_isListening","keywordIndex","process","e","console","error","_errorListener","PorcupineError","message","start","PorcupineInvalidStateError","hasRecordAudioPermission","addFrameListener","addErrorListener","frameLength","sampleRate","PorcupineRuntimeError","stop","removeErrorListener","removeFrameListener","numFrameListeners","delete"],"sources":["porcupine_manager.tsx"],"sourcesContent":["//\n// Copyright 2020-2025 Picovoice Inc.\n//\n// You may not use this file except in compliance with the license. A copy of the license is located in the \"LICENSE\"\n// file accompanying this source.\n//\n// Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n// an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n// specific language governing permissions and limitations under the License.\n//\n\nimport {\n  VoiceProcessor,\n  VoiceProcessorError,\n  VoiceProcessorErrorListener,\n  VoiceProcessorFrameListener,\n} from '@picovoice/react-native-voice-processor';\n\nimport Porcupine from './porcupine';\nimport * as PorcupineErrors from './porcupine_errors';\nimport type BuiltInKeywords from './builtin_keywords';\nexport type DetectionCallback = (keywordIndex: number) => void;\nexport type ProcessErrorCallback = (\n  error: PorcupineErrors.PorcupineError\n) => void;\n\nclass PorcupineManager {\n  private readonly _voiceProcessor: VoiceProcessor;\n  private readonly _errorListener: VoiceProcessorErrorListener;\n  private readonly _frameListener: VoiceProcessorFrameListener;\n  private _porcupine: Porcupine | null;\n\n  private _isListening: boolean = false;\n\n  /**\n   * Static creator for initializing a Porcupine Manager from built-in keywords\n   *\n   * @param accessKey AccessKey obtained from Picovoice Console (https://console.picovoice.ai/).\n   * @param keywords List of keywords (phrases) for detection. The list of available (default) keywords can be retrieved.\n   * using `Porcupine.KEYWORDS`. If `keyword_paths` is set then this argument will be ignored.\n   * @param detectionCallback A callback for when Porcupine detects the specified keywords.\n   * @param processErrorCallback A callback for when Porcupine process function triggers an error.\n   * @param modelPath Path to the file containing model parameters. If not set it will be set to the default location.\n   * @param device String representation of the device (e.g., CPU or GPU) to use for inference.\n   * If set to `best`, the most suitable device is selected automatically. If set to `gpu`, the engine uses the\n   * first available GPU device. To select a specific GPU device, set this argument to `gpu:${GPU_INDEX}`, where\n   * `${GPU_INDEX}` is the index of the target GPU. If set to `cpu`, the engine will run on the CPU with the\n   * default number of threads. To specify the number of threads, set this argument to `cpu:${NUM_THREADS}`,\n   * where `${NUM_THREADS}` is the desired number of threads.\n   * @param sensitivities sensitivities for each keyword model. A higher sensitivity reduces miss rate\n   * at the cost of potentially higher false alarm rate. Sensitivity should be a floating-point number within\n   * [0, 1].\n   * @returns An instance of the Porcupine Manager.\n   */\n  public static async fromBuiltInKeywords(\n    accessKey: string,\n    keywords: BuiltInKeywords[],\n    detectionCallback: DetectionCallback,\n    processErrorCallback?: ProcessErrorCallback,\n    modelPath?: string,\n    device?: string,\n    sensitivities?: number[]\n  ) {\n    let porcupine = await Porcupine.fromBuiltInKeywords(\n      accessKey,\n      keywords,\n      modelPath,\n      device,\n      sensitivities\n    );\n    return new PorcupineManager(\n      porcupine,\n      detectionCallback,\n      processErrorCallback\n    );\n  }\n\n  /**\n   * Static creator for initializing a Porcupine Manager from paths to custom keywords.\n   *\n   * @param accessKey AccessKey obtained from Picovoice Console (https://console.picovoice.ai/).\n   * @param keywordPaths Absolute paths to keyword model files.\n   * @param detectionCallback A callback for when Porcupine detects the specified keywords.\n   * @param processErrorCallback A callback for when Porcupine process function triggers an error.\n   * @param modelPath Path to the file containing model parameters. If not set it will be set to the default location.\n   * @param device String representation of the device (e.g., CPU or GPU) to use for inference.\n   * If set to `best`, the most suitable device is selected automatically. If set to `gpu`, the engine uses the\n   * first available GPU device. To select a specific GPU device, set this argument to `gpu:${GPU_INDEX}`, where\n   * `${GPU_INDEX}` is the index of the target GPU. If set to `cpu`, the engine will run on the CPU with the\n   * default number of threads. To specify the number of threads, set this argument to `cpu:${NUM_THREADS}`,\n   * where `${NUM_THREADS}` is the desired number of threads.\n   * @param sensitivities sensitivities for each keyword model. A higher sensitivity reduces miss rate\n   * at the cost of potentially higher false alarm rate. Sensitivity should be a floating-point number within\n   * [0, 1].\n   * @returns An instance of the Porcupine Manager.\n   */\n  public static async fromKeywordPaths(\n    accessKey: string,\n    keywordPaths: string[],\n    detectionCallback: DetectionCallback,\n    processErrorCallback?: ProcessErrorCallback,\n    modelPath?: string,\n    device?: string,\n    sensitivities?: number[]\n  ) {\n    let porcupine = await Porcupine.fromKeywordPaths(\n      accessKey,\n      keywordPaths,\n      modelPath,\n      device,\n      sensitivities\n    );\n    return new PorcupineManager(\n      porcupine,\n      detectionCallback,\n      processErrorCallback\n    );\n  }\n\n  private constructor(\n    porcupine: Porcupine,\n    detectionCallback: DetectionCallback,\n    processErrorCallback?: ProcessErrorCallback\n  ) {\n    this._porcupine = porcupine;\n    this._voiceProcessor = VoiceProcessor.instance;\n    this._frameListener = async (frame: number[]) => {\n      if (this._porcupine === null || !this._isListening) {\n        return;\n      }\n      try {\n        let keywordIndex: number = await this._porcupine.process(frame);\n        if (keywordIndex >= 0) {\n          detectionCallback(keywordIndex);\n        }\n      } catch (e) {\n        if (processErrorCallback) {\n          processErrorCallback(e as PorcupineErrors.PorcupineError);\n        } else {\n          console.error(e);\n        }\n      }\n    };\n\n    this._errorListener = (error: VoiceProcessorError) => {\n      if (processErrorCallback) {\n        processErrorCallback(new PorcupineErrors.PorcupineError(error.message));\n      } else {\n        console.error(error);\n      }\n    };\n  }\n\n  /**\n   * Opens audio input stream and sends audio frames to Porcupine\n   */\n  public async start(): Promise<void> {\n    if (this._isListening) {\n      return;\n    }\n\n    if (this._porcupine === null) {\n      throw new PorcupineErrors.PorcupineInvalidStateError(\n        'Cannot start Porcupine - resources have already been released'\n      );\n    }\n\n    if (await this._voiceProcessor.hasRecordAudioPermission()) {\n      this._voiceProcessor.addFrameListener(this._frameListener);\n      this._voiceProcessor.addErrorListener(this._errorListener);\n      try {\n        await this._voiceProcessor.start(\n          this._porcupine.frameLength,\n          this._porcupine.sampleRate\n        );\n      } catch (e: any) {\n        throw new PorcupineErrors.PorcupineRuntimeError(\n          `Failed to start audio recording: ${e.message}`\n        );\n      }\n    } else {\n      throw new PorcupineErrors.PorcupineRuntimeError(\n        'User did not give permission to record audio.'\n      );\n    }\n\n    this._isListening = true;\n  }\n\n  /**\n   * Closes audio stream\n   */\n  public async stop(): Promise<void> {\n    if (!this._isListening) {\n      return;\n    }\n\n    this._voiceProcessor.removeErrorListener(this._errorListener);\n    this._voiceProcessor.removeFrameListener(this._frameListener);\n\n    if (this._voiceProcessor.numFrameListeners === 0) {\n      try {\n        await this._voiceProcessor.stop();\n      } catch (e: any) {\n        throw new PorcupineErrors.PorcupineRuntimeError(\n          `Failed to stop audio recording: ${e.message}`\n        );\n      }\n    }\n\n    this._isListening = false;\n  }\n\n  /**\n   * Releases resources and listeners\n   */\n  delete() {\n    if (this._porcupine !== null) {\n      this._porcupine.delete();\n      this._porcupine = null;\n    }\n  }\n}\n\nexport default PorcupineManager;\n"],"mappings":"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"}